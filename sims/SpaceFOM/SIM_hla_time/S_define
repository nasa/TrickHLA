//==========================================================================
// Space Reference FOM: Simple HLA time managed federate.
//==========================================================================
// Description:
// This is a simulation definition file (S_define) that provides an example
// of an SpaceFOM compliant federate that uses the HLA time management APIs.
//==========================================================================

//==========================================================================
// Define the Trick executive and services simulation object instances:
// Use the "standard" Trick executive simulation object. This simulation
// object provides the traditional Trick executive capabilities but can be
// tailored to provide facility or project unique executive behavior. See
// the Trick documentation for more on usage and available options.
//==========================================================================
#include "sim_objects/default_trick_sys.sm"

//==========================================================================
// Define the TrickHLA job cycle times.
//==========================================================================
#define THLA_DATA_CYCLE_TIME  0.250 // HLA time and data cycle time.

//==========================================================================
// TrickHLA and SpaceFOM include files used in SimObject definitions or
// for input file instantiations.
//==========================================================================

// TrickHLA includes.
##include "TrickHLA/Federate.hh"
##include "TrickHLA/Manager.hh"
##include "TrickHLA/SimTimeline.hh"
##include "TrickHLA/ScenarioTimeline.hh"

%header{
 using namespace TrickHLA;
 using namespace SpaceFOM;
%}


//==========================================================================
// SIM_OBJECT: THLA - Generalized TrickHLA interface routines.
//==========================================================================
#include "SpaceFOM/SpaceFOM.sm"


//==========================================================================
// SIM_OBJECT: THLA_INIT - An example of a TrickHLA multi-phase
// initialization SimObject.
//==========================================================================
class THLAInitSimObject : public Trick::SimObject {

 public:
   THLAInitSimObject( TrickHLA::Manager  & thla_mngr,
                      TrickHLA::Federate & thla_fed,
                      unsigned int         _MPI_1   = 100,
                      unsigned int         _MPI_END = 500 )
      : thla_manager( thla_mngr ),
        thla_federate( thla_fed )
   {
      //--------------------------------------------------------------------
      // NOTE: Initialization phase numbers must be greater than P60
      // (i.e. P_HLA_INIT) so that the initialization jobs run after the
      // P60 THLA.manager->initialize() job.
      //--------------------------------------------------------------------

      // Clear remaining initialization sync-points.
      P_MPI_1 ("initialization") thla_manager.clear_init_sync_points();
   }

 private:
   TrickHLA::Manager  & thla_manager;
   TrickHLA::Federate & thla_federate;

   // Do not allow the implicit copy constructor or assignment operator.
   THLAInitSimObject( THLAInitSimObject const & rhs );
   THLAInitSimObject & operator=( THLAInitSimObject const & rhs );

   // Do not allow the default constructor.
   THLAInitSimObject();
};


//==========================================================================
// SimObject instantiations.
//==========================================================================
// Main TrickHLA SimObject that supports SpaceFOM.
SpaceFOMSimObject THLA( THLA_DATA_CYCLE_TIME, THLA_DATA_CYCLE_TIME );

// Simulation specific multiphase initialization SimObject instance.
THLAInitSimObject THLA_INIT( THLA.manager, THLA.federate );
